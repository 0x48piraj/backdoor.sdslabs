#!/usr/local/bin/python
from Crypto.Util.number import *
import sys
flag =open('flag.txt','r').read()
temp_m,m,p,q =open('message.txt','r').read().split("\n")
temp_m = int(temp_m)
n = 14594526805528734291285794770307986141123407358463049896196834792392613023383822845812423295311360581134377251473472216672770913081639286149320105573740663328729432889232127208093946780477015467697172837036558596297018552568011022030998428719743697000919280745949211935082058528038112081892825767057594527137713126182648506473521673814904603811517716220285021143122558397466918793106419894385571570464457360107642431958226892635151817553036005633151635158047101005854439595340593919026279150723253093361981975208976308035762068730799920822406933146913777989751379218923430067385714464509081531072722623608405110835599
c = 62322358110060777554275724547213261461428710934287446553312256309033302719924434543660243284758637874779236331748744421408738751983639181297073343141503334591735891888548482747427282841067660906929162466662251778917404271271582893682637778728358215212070314060168389767095968544662232649349648160972533947427769852590409967291771519313112596556782056474602034232292108001468098895957456251016874596242692536202925567610378326830767705800895343493886070084424774523994157564740274674394921794144490155433503780232355209178263327004495846554269902689354751689985080648529602929

print "n = ",n
print "c = ",c
print "e < 100"
sys.stdout.flush()
message = int(raw_input("Enter the decoded message to proceed further "))

if message == temp_m : 
	p,q = int(p),int(q)
	m = m.replace("\r","")
	m1 = int(m.encode("hex").replace("0x",'').replace("L",''),16)	
	n1 = p*q
	n2 = (p+4)*(q+4)
	print "n1 = ",n1
	print "n2 = ",n2
	sys.stdout.flush()
	e = 65537 
	d1 = inverse(e, (p-1)*(q-1))
	d2 = inverse(e, (p+3)*(q+3))
	c = pow(m1,e,n1)
	c = pow(c,e,n2)
	print "c = ",c
	sys.stdout.flush()
	temp_m = raw_input("What is your decoded message? ").replace("\r",'').replace("\n",'')
	if temp_m==m:
		print "Congrats! This is your flag ",flag
	else:
		print "Better Luck Next Time"	
	sys.stdout.flush()
else:
	print "Try again!"
	sys.stdout.flush()
